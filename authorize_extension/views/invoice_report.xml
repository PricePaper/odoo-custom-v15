<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <template id="ppt_custom_invoice_template_tr_fee" inherit_id="batch_delivery.ppt_custom_invoice_template">
          <xpath expr="//div[@id='total']/div[2]/table/t[2]" position="replace">
              <t t-foreach="tax_totals['subtotals']" t-as="subtotal">
                  <tr class="border-black o_subtotal">
                      <td style="border:1px solid #7a7a7a;padding:8px 12px; "><span t-esc="subtotal['name']"/></td>

                      <td align="right" style="border:1px solid #7a7a7a; font-weight:bold;padding:8px 12px;">
                          <span t-att-class="oe_subtotal_footer_separator" t-esc="subtotal['formatted_amount']"/>
                      </td>
                  </tr>

                  <t t-set="subtotal_to_show" t-value="subtotal['name']"/>
                  <t t-foreach="tax_totals['groups_by_subtotal'][subtotal_to_show]" t-as="amount_by_group">
                      <tr>
                          <t t-if="False">
                              <td style="border:1px solid #7a7a7a;padding:8px 12px;">
                                  <span t-esc="amount_by_group['tax_group_name']"/>
                                  <span class="text-nowrap"> on
                                      <t t-esc="amount_by_group['formatted_tax_group_base_amount']"/>
                                  </span>
                              </td>
                              <td class="text-end o_price_total" align="right" style="border:1px solid #7a7a7a; font-weight:bold;padding:8px 12px;">
                                  <span class="text-nowrap" t-esc="amount_by_group['formatted_tax_group_amount']"/>
                              </td>
                          </t>
                          <t t-else="">
                              <td style="border:1px solid #7a7a7a;padding:8px 12px; "><span class="text-nowrap" t-esc="amount_by_group['tax_group_name']"/></td>
                              <td class="text-end o_price_total" align="right" style="border:1px solid #7a7a7a; font-weight:bold;padding:8px 12px;">
                                  <span class="text-nowrap" t-esc="amount_by_group['formatted_tax_group_amount']" />
                              </td>
                          </t>
                      </tr>
                  </t>
              </t>

              <t t-set="gross_total" t-value="o.amount_total + o.transaction_fee"/>
              <t t-if="o.transaction_fee == 0">
                  <t t-set="gross_total" t-value="round(o.amount_total + o.get_transaction_fee(), 2)"/>
              </t>
              <tr class="border-black o_total">
                  <td style="border:1px solid #7a7a7a;padding:8px 12px; "><span>Credit Card Total</span></td>
                  <td align="right" style="border:1px solid #7a7a7a; font-weight:bold;padding:8px 12px;">
                      <span t-field="o.currency_id.symbol"/>
                      <span t-esc="'%.2f'% gross_total"/>
                  </td>
              </tr>
              <tr class="border-black o_total">
                  <td style="border:1px solid #7a7a7a; font-size:18px; font-weight:bold; padding:8px 12px; "><strong>Discounted Total</strong></td>
                  <td align="right" style="border:1px solid #7a7a7a; font-size:18px; font-weight:bold; padding:8px 12px;">
                      <span t-esc="tax_totals['formatted_amount_total']"/>
                  </td>
              </tr>


          </xpath>
        </template>

    </data>
</odoo>
