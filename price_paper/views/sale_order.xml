<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!--overriden(replaced) the whole delivery module inherrit for sales order form  this is done to ensure the get/set delivery views are available in confirmed state order-->
        <record id="delivery.view_order_form_with_carrier" model="ir.ui.view">
            <field name="name">delivery.sale.order.form.view.with_carrier</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">

                    <xpath expr="//field[@name='payment_term_id']" position="after">
                        <field name="id" invisible="1"/>
                        <field name="available_carrier_ids" invisible="1"/>
                        <label for="carrier_id"/>
                        <div name='carrier_selection'>
                            <div>
                                <field name="carrier_id" domain="[('id', 'in', available_carrier_ids)]"
                                       context="{'order_id': id}" class="oe_inline"
                                       options="{'no_create': True, 'no_open': True}"
                                       attrs="{'readonly':[('state','not in',('draft','sent'))]}"/> <i
                                    class="fa fa-check text-success" role="img" aria-label="Rating OK" title="Rating OK"
                                    attrs="{'invisible':['|','|',('carrier_id','=',False),('state','not in',('draft','sent','sale')),('delivery_rating_success','=',False)]}"></i>
                            </div>
                            <div>
                                <field name='delivery_price' widget='monetary' class="oe_inline"
                                       options="{'currency_field': 'currency_id'}" nolabel="1"
                                       attrs="{'invisible': [('carrier_id','=', False)]}" force_save="1"/>
                                <button name="get_delivery_price" type="object" class="oe_inline oe_link"
                                        attrs="{'invisible':['|',('carrier_id','=',False),('state','not in',('draft','sent','sale'))]}"><i
                                        class="fa fa-arrow-right"/> Get rate</button>
                                <button name="set_delivery_line" type="object" class="oe_inline oe_link"
                                        attrs="{'invisible':['|','|',('carrier_id','=',False),('state','not in',('draft','sent','sale')),('delivery_rating_success','=',False)]}"><i
                                        class="fa fa-arrow-right"/> Add to order</button>
                                <field name='delivery_rating_success' invisible="1" force_save="1"/>
                            </div>
                            <div class="alert alert-info" role="status"
                                 attrs="{'invisible': ['|',('carrier_id','=', False),('delivery_message','=',False)]}">
                                <field name='delivery_message' force_save="1"/>
                            </div>
                        </div>
                    </xpath>

                    <xpath expr="//field[@name='product_uom_qty']" position="after">
                        <field name="product_qty" invisible="1"/>
                    </xpath>
                    <xpath expr="//field[@name='order_line']/form//field[@name='product_id']" position="after">
                        <field name="sale_uom_ids" invisible="1"/>
                    </xpath>
                    <xpath expr="//field[@name='order_line']/form//field[@name='product_uom']" position="attributes">
                        <attribute name="domain">[('id', 'in', sale_uom_ids)]</attribute>
                    </xpath>
                    <xpath expr="//group[hasclass('oe_subtotal_footer')]" position="before">
                        <group name="weight_volume">
                            <field name="total_volume"/>
                            <field name="total_weight"/>
                            <field name="total_qty"/>
                        </group>
                    </xpath>

            </field>
        </record>

        <record id="sale_order_form_inherit_price_paper_hold" model="ir.ui.view">
            <field name="name">sale.order.form.inherit.hold</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
            <field name="arch" type="xml">
                <field name="name" position="after">
                    <field name="hold_state"/>
                </field>
            </field>
        </record>

        <record id="inherit_sale_order_form_view" model="ir.ui.view">
            <field name="name">inherited.sale.order.form.view</field>
            <field name="model">sale.order</field>
            <field name="type">form</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">

                <sheet position='before'>
                    <div class="oe_form_box_info oe_text_center"
                         attrs="{'invisible':['|', ('is_creditexceed', '=', False), ('ready_to_release', '=', True)]}">
                        <p attrs="{'invisible':[('is_creditexceed', '=', False)]}">
                            <b><field name='credit_warning'/></b>
                        </p>

                    </div>
                    <div class="oe_form_box_info oe_text_center"
                         attrs="{'invisible':['|', ('is_low_price', '=', False), ('release_price_hold', '=', True)]}">
                        <p attrs="{'invisible':[('is_low_price', '=', False)]}">
                            <b><field name='low_price_warning'/></b>
                        </p>
                    </div>
                </sheet>

                <xpath expr="//field[@name='validity_date']" position="after">
                    <field name="storage_contract" invisible="1"/>
                    <field name="show_contract_line" invisible="1"/>
                    <field name="hold_state" invisible='1'/>
                </xpath>

                <field name="partner_id" position="before">
                    <field name="customer_code"/>
                </field>

                <field name="partner_id" position="attributes">
                    <attribute name="options">{"no_create": 1, "no_create_edit": 1}</attribute>
                    <attribute name="domain">[('type', '=', 'contact'), ('customer', '=', True), ('parent_id', '=', False)]</attribute>
                    <attribute name="context">{'search_default_customer': 1, 'show_address': 1, 'tree_view_ref': 'view_partner_tree_search_more',
                                               'address_inline': 1, 'show_partner_code': 1, 'show_vat': 0}</attribute>
                </field>

                <field name="partner_invoice_id" position="attributes">
                    <attribute name="invisible">True</attribute>
                    <attribute name="domain">['|', ('id', '=', partner_id), '&amp;', ('parent_id', '=', partner_id), ('type', '=', 'invoice')]</attribute>
                    <attribute name="options">{"no_create": 1, "no_create_edit": 1}</attribute>
                    <attribute name="context">{'default_type': 'invoice', 'address_inline': 1, 'show_address': 1, 'tree_view_ref': 'view_partner_tree_search_more', 'show_partner_code': 1}</attribute>
                </field>
                <field name="partner_id" position="after">
                  <field name="invoice_address_id" required='1' context="{'default_type': 'invoice', 'address_inline': 1, 'show_address': 1, 'tree_view_ref': 'view_partner_tree_search_more'}"
                    domain="['|', ('id', '=', partner_id), '&amp;', ('parent_id', '=', partner_id), ('type', '=', 'invoice')]"/>
                </field>

                <field name="partner_shipping_id" position="attributes">
                    <attribute name="domain">['|', ('id', '=', partner_id), ('parent_id', '=', partner_id)]</attribute>
                    <attribute name="options">{"no_create": 1, "no_create_edit": 1, "always_reload": True}</attribute>
                    <attribute name="context">{'default_type': 'invoice', 'show_address': 1, 'tree_view_ref': 'view_partner_tree_search_more', 'show_partner_code': 1}</attribute>
                </field>

                <button name="action_cancel" position="after">
                    <button name="action_release_credit_hold" type="object" string="Release Credit Hold"
                            groups="price_paper.group_allow_more_than_credit_limit"
                            attrs="{'invisible': ['|', ('is_creditexceed', '=', False), ('ready_to_release', '=', True)]}"/>
                    <button name="action_release_price_hold" type="object" string="Release Price Hold"
                            groups="price_paper.group_allow_low_price_unit"
                            attrs="{'invisible': ['|', ('is_low_price', '=', False), ('release_price_hold', '=', True)]}"/>
                </button>

                <button name="action_quotation_send" position="after">
                    <button name="action_fax_send" string="Send by Fax" type="object" states="draft,order,sent"
                            class="btn-primary"/>
                </button>

                <button name="action_draft" position="attributes">
                    <attribute name="string">Set to Draft</attribute>
                </button>

                <xpath expr="//field[@name='validity_date']" position="after">
                    <field name="release_date" required='1'/>
                    <field name="deliver_by" required='1'/>
                    <field name="is_creditexceed" invisible="1"/>
                    <field name="is_low_price" invisible="1"/>
                    <field name="release_price_hold" invisible="1"/>
                    <field name="ready_to_release" invisible="1"/>
                </xpath>

                <xpath expr="//field[@name='pricelist_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <xpath expr="//tree[1]" position="attributes">
                    <attribute name="editable"/>
                    <attribute name="decoration-danger">profit_margin&lt;0</attribute>
                    <attribute name="decoration-info">profit_margin==0</attribute>
                    <attribute name="decoration-success">profit_margin&gt;0</attribute>
                </xpath>

                <xpath expr="//field[@name='order_line']/form//field[@name='product_id']" position="attributes">
                    <attribute name="options">{"no_create": False}</attribute>
                </xpath>

                 <xpath expr="//field[@name='order_line']/form//label[@for='qty_delivered']" position="before">
                     <field name="storage_contract_line_id" options="{'no_create': False}"
                            attrs="{'invisible': [('parent.show_contract_line', '=', False)]}"
                            domain="[('order_id.state', '=', 'released'), ('order_id.storage_contract', '=', True), ('is_downpayment', '=', False), ('storage_remaining_qty', '&gt;', 0), ('order_id.partner_id', '=', parent.partner_id)]"
                     invisible="1"/>
                 </xpath>
                <xpath expr="//field[@name='order_line']/tree/field[@name='price_unit']" position="before">
                    <field name="lst_price" readonly="1"/>
                    <field name="working_cost" invisible="1"/>
                    <field name="price_lock" invisible="1"/>
                </xpath>

                <xpath expr="//field[@name='order_line']/tree/field[@name='price_unit']" position="attributes">
                    <attribute name="attrs">{"readonly": [('price_lock', '=', True)]}</attribute>
                </xpath>

                <xpath expr="//field[@name='order_line']/tree/field[@name='price_unit']" position="after">
                    <field name="profit_margin"/>
                    <field name="price_from" invisible="1"/>
                </xpath>

                <xpath expr="//field[@name='order_line']/form/group[1]/group[1]/field[@name='price_unit']"
                       position="before">
                    <field name="lst_price" readonly="1" attrs="{'invisible': [('display_type', '!=', False)]}"/>
                    <field name="working_cost" invisible="1"/>
                    <field name="price_lock" invisible="1"/>
                </xpath>

                <xpath expr="//field[@name='order_line']/form/group[1]/group[1]/field[@name='price_unit']"
                       position="attributes">
                    <attribute name="attrs">{"readonly": [('price_lock', '=', True)]}</attribute>
                    <attribute name="force_save">1</attribute>
                </xpath>

                <xpath expr="//field[@name='order_line']/form/group[1]/group[1]/field[@name='price_unit']"
                       position="after">
                    <field name="update_pricelist"/>
                    <field name="profit_margin" attrs="{'invisible': [('display_type', '!=', False)]}"/>
                    <field name="price_from" invisible="1"/>
                </xpath>

                <xpath expr="//field[@name='order_line']/tree/field[@name='product_id']" position="attributes">
                    <attribute name="options">{"no_create": 1, "no_create_edit": 1}</attribute>
                </xpath>

                <xpath expr="//field[@name='order_line']/form/group[1]/group[1]/field[@name='product_id']"
                       position="attributes">
                    <attribute name="options">{"no_create": 1, "no_create_edit": 1}</attribute>
                </xpath>

                <xpath expr="//field[@name='order_line']/form/group[1]" position="after">
                    <div>
                        <group>
                            <group>
                                <field name="product_onhand" readonly='1'
                                       attrs="{'invisible': [('display_type', '!=', False)]}" help='Qty on hand'/>
                                <field name="note" attrs="{'invisible': [('display_type', '!=', False)]}"/>
                                <field name="note_type" widget='radio'
                                       attrs="{'invisible': [('display_type', '!=', False)]}"/>
                            </group>
                            <group>
                              <field name="similar_product_price" readonly="1" nolabel='1' force_save="1"/>
                            </group>
                        </group>
                    </div>
                    <div attrs="{'invisible': ['|', ('state', 'in', ['sale', 'done', 'cancel']), ('display_type', '!=', False)]}">
                        <label for="last_sale"/>
                        <field name="last_sale"/>
                    </div>
                </xpath>

                <xpath expr="//field[@name='amount_untaxed']" position="after">
                    <field name="gross_profit" widget="monetary"
                           options="{'currency_field': 'currency_id', 'field_digits': True}"/>
                </xpath>

                <xpath expr="//field[@name='order_line']" position="before">
                    <button type="object" name="add_purchase_history_to_so_line" string="Browse History Lines"
                            context="{'partner':partner_id}" class="oe_edit_only oe_highlight"/>
                    <button type="action" name="%(action_sc_popup_windows)d" string="Browse Storage Contract"
                             context="{'default_partner_id':partner_id}" class="oe_edit_only oe_highlight"
                    />

                </xpath>

                <xpath expr="//field[@name='order_line']/form" position="inside">
                    <script>
                        var $footer = $('.modal footer');
                        $('.modal header').after($footer);
                    </script>
                </xpath>

            </field>
        </record>

        <record id="view_sales_order_filter_price_paper" model="ir.ui.view">
            <field name="name">sale.order.list.select.inherit.price.paper</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter"/>
            <field name="arch" type="xml">
                 <xpath expr="//filter[@name='my_sale_orders_filter']" position="attributes">
                     <attribute name="domain">[('state', 'in', ['sale', 'done'])]</attribute>
                     <attribute name="context">{'my_orders': True}</attribute>
                </xpath>
            </field>
        </record>
        <record id="sale_order_view_search_price_paper" model="ir.ui.view">
            <field name="name">sale.order.search.inherit.price.paper</field>
            <field name="model">sale.order</field>
            <field name="mode">primary</field>
            <field name="inherit_id" ref="sale.sale_order_view_search_inherit_quotation"/>
            <field name="arch" type="xml">
                <xpath expr="//filter[@name='my_quotation']" position="replace">
                    <filter string="My Drafts" name="my_quotation" domain="[('state','in',('draft', 'sent'))]" context="{'my_draft':True}"/>
                </xpath>

                <xpath expr="//filter[@name='draft']" position="replace">
                    <filter string="Drafts" name="draft" domain="[('state','in',('draft', 'sent'))]"/>
                </xpath>
            </field>
        </record>

        <record id="sale.action_quotations" model="ir.actions.act_window">
            <field name="search_view_id" ref="price_paper.sale_order_view_search_price_paper"/>
            <field name="domain">[('state', 'in', ('draft', 'sent', 'cancel')), ('storage_contract', '=', False)]</field>
        </record>

        <record id="sale.action_quotations_with_onboarding" model="ir.actions.act_window">
            <field name="search_view_id" ref="price_paper.sale_order_view_search_price_paper"/>
            <field name="domain">[('state', 'in', ('draft', 'sent', 'cancel')), ('storage_contract', '=', False)]</field>
        </record>

        <record id="sale.action_quotations_salesteams" model="ir.actions.act_window">
            <field name="search_view_id" ref="price_paper.sale_order_view_search_price_paper"/>
            <field name="domain">[('state', 'in', ('draft', 'sent', 'cancel')), ('storage_contract', '=', False)]</field>
        </record>

        <record id="sale_order_view_search_credit_exceeded" model="ir.ui.view">
            <field name="name">sale.order.search.inherit.credit.exceeded</field>
            <field name="model">sale.order</field>
            <field name="mode">primary</field>
            <field name="inherit_id" ref="sale.sale_order_view_search_inherit_quotation"/>
            <field name="arch" type="xml">
                <xpath expr="//filter[@name='draft']" position="after">
                    <separator/>
                    <filter string="Credit Exceeded" name="credit_exceeded" domain="[('is_creditexceed','=', True)]"/>
                    <filter string="Low Price" name="credit_exceeded" domain="[('is_low_price','=', True)]"/>
                    <filter string="Credit limit Hold" name="ready_to_release"
                            domain="[('ready_to_release','=', False), ('is_creditexceed','=', True)]"/>
                    <filter string="Price Low Hold" name="release_price_hold"
                            domain="[('release_price_hold','=', False), ('is_low_price','=', True)]"/>
                </xpath>
                <xpath expr="//filter[@name='draft']" position="replace">
                    <filter string="Drafts" name="draft" domain="[('state','in',('draft', 'sent'))]"/>
                </xpath>
            </field>
        </record>

        <record id="sale.action_orders" model="ir.actions.act_window">
            <field name="context">{'create': False}</field>
        </record>

        <record id="sale.act_res_partner_2_sale_order" model="ir.actions.act_window">
            <field name="view_mode">tree,form,graph,pivot</field>
        </record>

        <record id="action_orders_credit_limit_exceeded" model="ir.actions.act_window">
            <field name="name">Orders On Hold</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="sale_order_view_search_credit_exceeded"/>
            <field name="context">{"search_default_ready_to_release": 1, "search_default_release_price_hold": 1}</field>
            <field name="help" type="html">
                <p>
                    No Holded Sale Order Found.
                </p>
            </field>
        </record>

        <record id="sale_order_tree_inherit_price" model="ir.ui.view">
            <field name="name">sale.order.tree.inherit.price</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_quotation_tree"/>
            <field name="arch" type="xml">
                <field name="state" position="replace"/>

                <field name="name" position="after">
                    <field name="state"/>
                    <field name="hold_state"/>

                </field>
            </field>
        </record>

        <record id="view_order_line_tree_inherit_pricepaper" model="ir.ui.view">
            <field name="name">sale.order.line.inherrit_pricepaper</field>
            <field name="model">sale.order.line</field>
            <field name="inherit_id" ref="sale.view_order_line_tree"/>
            <field name="arch" type="xml">
                <field name='name' position='after'>
                    <field name='confirmation_date'/>
                    <field name='is_last' invisible='1'/>
                    <field name='shipping_id'/>
                </field>

                <field name="price_subtotal" position="attributes">
                    <attribute name="invisible">1</attribute>
                </field>

                <field name="price_subtotal" position="after">
                    <field name="price_unit"/>
                </field>
            </field>
        </record>

        <record id="view_sale_order_line_search_inherit_price_paper" model="ir.ui.view">
            <field name="name">sale.order.line.search.pricepaper</field>
            <field name="model">sale.order.line</field>
            <field name="inherit_id" ref="sale.view_sales_order_line_filter"/>
            <field name="arch" type="xml">
                <field name="order_id" position="before">
                    <filter string="Last Purchase" name="is_last" domain="[('is_last','=',1)]"/>
                </field>
            </field>
        </record>

        <record id="act_res_partner_2_sale_order_line" model="ir.actions.act_window">
            <field name="name">Sales Order Lines</field>
            <field name="res_model">sale.order.line</field>
            <field name="view_mode">tree</field>
            <field name="context">{'search_default_order_partner_id': [active_id],
                                   'default_order_partner_id': active_id, 'search_default_is_last': 1}</field>
            <field name="domain">[('state', 'in', ['sale', 'done'])]</field>
        </record>

        <record id="sale_order_line_tree_pricepaper" model="ir.ui.view">
            <field name="name">sale.order.line.tree</field>
            <field name="model">sale.order.line</field>
            <field name="arch" type="xml">
                <tree string="Sales Order Lines" create="false">
                    <field name="order_id"/>
                    <field name="order_partner_id"/>
                    <field name="name"/>
                    <field name="salesman_id"/>
                    <field name="product_uom_qty" string="Qty"/>
                    <field name="qty_delivered"/>
                    <field name="remaining_qty"/>
                    <field name="product_uom" string="Unit of Measure" groups="uom.group_uom"/>
                    <field name="price_subtotal" sum="Total" widget="monetary"/>
                </tree>
            </field>
        </record>

        <record id="act_product_2_sale_order_line" model="ir.actions.act_window">
            <field name="name">Sales Order Lines</field>
            <field name="res_model">sale.order.line</field>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="sale_order_line_tree_pricepaper"/>
            <field name="context">{'search_default_product_id': [active_id],
                                   'default_product_id': active_id}</field>
            <field name="domain">[('state', 'in', ['sale'])]</field>
        </record>

        <record id="sale.action_quotations" model="ir.actions.act_window">
            <field name="domain">[('state', 'in', ('draft', 'sent', 'cancel')), ('storage_contract', '=', False)]</field>
            <field name="context">{'default_is_quotation': 1}</field>
            <field name="name">Drafts</field>
        </record>

        <record id="sale.action_orders" model="ir.actions.act_window">
          <field name="domain">[('state', 'not in', ('draft', 'sent', 'cancel')), ('storage_contract', '=', False)]</field>
        </record>

        <record id="sale.action_quotations_with_onboarding" model="ir.actions.act_window">
            <field name="name">Drafts</field>
            <field name="domain">[('state', 'in', ('draft', 'sent', 'cancel')), ('storage_contract', '=', False)]</field>
        </record>
        <record model="ir.actions.server" id="action_confirm_multiple_orders">
            <field name="name">Confirm</field>
            <field name="model_id" ref="sale.model_sale_order"/>
            <field name="binding_model_id" ref="sale.model_sale_order"/>
            <field name="state">code</field>
            <field name="code">
action = records.env['sale.order'].confirm_multiple_orders(records)
            </field>
        </record>

                <record id="view_storage_contract_order_form" model="ir.ui.view">
                <field name="name">sale.order.form</field>
                <field name="model">sale.order</field>
                <field name="arch" type="xml">
                    <form string="Sales Order" class="o_sale_order">
                    <header>
                        <field name="sc_po_done" invisible="1"/>
                        <field name="invoice_status" invisible="1"/>
                        <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice"
                            type="action" class="btn-primary"
                            attrs="{'invisible': [('invoice_status', '!=', 'to invoice')]}"/>
                        <button name="%(sale.action_view_sale_advance_payment_inv)d" string="Create Invoice" type="action" context="{'default_advance_payment_method': 'percentage'}" attrs="{'invisible': ['|',('invoice_status', '!=', 'no'), ('state', '!=', 'sale')]}"/>
                        <button name="action_storage_contract_confirm" type="object" string="Confirm" class="oe_highlight" states="draft"/>
                        <button name="action_create_storage_do" type="object" string="Create PO" class="oe_highlight" attrs="{'invisible': ['|', ('state', '=', 'draft'), ('sc_po_done', '=', True)]}"/>
                        <button name="action_release" groups="account.group_account_manager" type="object" string="Release" class="oe_highlight" attrs="{'invisible': [('state', '!=', 'done')]}"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,sale"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_invoice"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-pencil-square-o"
                                attrs="{'invisible': [('invoice_count', '=', 0)]}">
                                <field name="invoice_count" widget="statinfo" string="Invoices"/>
                            </button>
                            <button type="object"
                               name="action_view_purchase"
                               class="oe_stat_button"
                               icon="fa-shopping-cart"
                               attrs="{'invisible': [('purchase_order_count', '=', 0)]}"
                               groups="purchase.group_purchase_user">
                               <field name="purchase_order_count" widget="statinfo" string="Purchase Orders"/>
                           </button>
                        </div>
                        <div class="oe_title">
                            <h1>
                                <field name="name" readonly="1"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="partner_id" widget="res_partner_many2one" domain="[('customer','=',True)]" context="{'search_default_customer':1, 'show_address': 1, 'show_vat': True}" options='{"always_reload": True}'/>
                                <field name="partner_invoice_id" groups="sale.group_delivery_invoice_address" context="{'default_type':'invoice'}" options='{"always_reload": True}'/>
                                <field name="partner_shipping_id" groups="sale.group_delivery_invoice_address" context="{'default_type':'delivery'}" options='{"always_reload": True}'/>
                                <field name="company_id" invisible="1"/>
                            </group>
                            <group>
                                <field name="confirmation_date" attrs="{'invisible': [('confirmation_date', '=', False)]}"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="payment_term_id" options="{'no_create': True}" attrs="{'readonly': [('state', 'in', ('sale','done', 'cancel', 'released'))]}"/>
                                <field name="pricelist_id" invisible="1"/>
                                <field name="storage_contract" invisible="1"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Order Lines" name="order_lines">
                                <field
                                    name="order_line"
                                    widget="section_and_note_one2many"
                                    mode="tree"
                                    attrs="{'readonly': [('state', 'in', ('done','cancel'))]}"
                                >
                                    <tree
                                        string="Sales Order Lines"
                                        editable="bottom"
                                        decoration-info="(not display_type and invoice_status == 'to invoice')"
                                    >
                                        <control>
                                            <create string="Add a product"/>
                                            <create string="Configure a product" context="{'open_product_configurator': True}" groups="product.group_product_variant"/>
                                            <create string="Add a section" context="{'default_display_type': 'line_section'}"/>
                                            <create string="Add a note" context="{'default_display_type': 'line_note'}"/>
                                        </control>

                                        <field name="sequence" widget="handle" />
                                        <field name="display_type" invisible="1"/>
                                        <field name="product_updatable" invisible="1"/>
                                        <field name="product_id"
                                            attrs="{
                                                'readonly': ['|', ('product_updatable', '=', False), ('state', 'in', ('sale','done', 'cancel', 'released'))],
                                                'required': [('display_type', '=', False)],
                                            }"
                                            force_save="1"
                                            context="{
                                                'partner_id': parent.partner_id,
                                                'quantity': product_uom_qty,
                                                'pricelist': parent.pricelist_id,
                                                'uom':product_uom,
                                                'company_id': parent.company_id,
                                                'default_lst_price': price_unit,
                                                'default_description_sale': name
                                            }"
                                        />
                                        <field name="product_custom_attribute_value_ids" invisible="1" />
                                        <field name="product_no_variant_attribute_value_ids" invisible="1" />
                                        <field name="name" widget="section_and_note_text"
                                          attrs="{
                                              'readonly': [('state', 'in', ('sale','done', 'cancel', 'released'))]}"/>
                                        <field
                                            name="product_uom_qty"
                                            string="OrderQty"
                                            attrs="{
                                                'readonly': [('state', 'in', ('sale','done', 'cancel', 'released'))]}"
                                            context="{
                                                'partner_id': parent.partner_id,
                                                'quantity': product_uom_qty,
                                                'pricelist': parent.pricelist_id,
                                                'uom': product_uom,
                                                'company_id': parent.company_id
                                            }"
                                        />
                                        <field name="selling_min_qty" attrs="{'readonly': [('state', '=', 'cancel')]}"/>
                                        <field
                                            name="storage_remaining_qty"
                                            attrs="{
                                                'column_invisible': [('parent.state', 'not in', ['sale', 'released'])],
                                            }"
                                        />
                                        <field name="qty_delivered" readonly="1" attrs="{'column_invisible': [('parent.state', 'not in', ['done', 'released'])]}"/>
                                        <field name="sale_uom_ids" invisible="1"/>
                                        <field
                                            name="product_uom"
                                            force_save="1"
                                            attrs="{
                                                'readonly': [('state', 'in', ('sale','done', 'cancel', 'released'))],
                                                'required': [('display_type', '=', False)],
                                            }"
                                            domain="[('id', 'in', sale_uom_ids)]"
                                            context="{'company_id': parent.company_id}"
                                            groups="uom.group_uom"
                                            options='{"no_open": True}'
                                        />
                                        <field
                                            name="price_unit" attrs="{
                                                'readonly': [('state', 'in', ('sale','done', 'cancel', 'released'))]}"
                                        />
                                        <field name="price_tax"/>
                                        <field name="tax_id" widget="many2many_tags" attrs="{'readonly': [('state', '=', 'released')]}"/>
                                        <field name="discount" groups="sale.group_discount_per_so_line" attrs="{
                                            'readonly': [('state', 'in', ('sale','done', 'cancel', 'released'))]}"/>
                                        <field name="price_subtotal" widget="monetary" groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <field name="price_total" widget="monetary" groups="account.group_show_line_subtotals_tax_included"/>
                                        <field name="state" invisible="1"/>
                                        <field name="invoice_status" invisible="1"/>
                                        <field name="customer_lead" invisible="1"/>
                                        <field name="currency_id" invisible="1"/>
                                        <field name="price_tax" invisible="1"/>
                                    </tree>
                                    <form>
                                        <field name="purchase_line_ids"/>
                                        <field name="invoice_lines"/>
                                        <field name="storage_contract_line_ids"/>
                                    </form>

                                </field>
                                <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                                    <field name="amount_untaxed" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    <field name="amount_tax" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                        <label for="amount_total" />
                                    </div>
                                    <field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                </group>
                                <field name="note" class="oe_inline" placeholder="Terms and conditions... (note: you can setup default ones in the Configuration menu)"/>
                                <div class="oe_clear"/>
                            </page>

                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                    </form>
                </field>
            </record>

        <record id="sale_order_view_search_storage_contract" model="ir.ui.view">
            <field name="name">sale.order.search.inherit.storage.contract</field>
            <field name="model">sale.order</field>
            <field name="mode">primary</field>
            <field name="inherit_id" ref="sale.sale_order_view_search_inherit_quotation"/>
            <field name="arch" type="xml">
                <xpath expr="//filter[@name='draft']" position="replace">
                    <filter string="Drafts" name="draft" domain="[('state','=','draft')]"/>
                    <filter string="Released" name="draft" domain="[('state','in',('draft', 'sent'))]"/>
                </xpath>
            </field>
        </record>

         <record id="action_storage_contract" model="ir.actions.act_window">
            <field name="name">Storage Contract</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="search_view_id" ref="sale_order_view_search_storage_contract"/>
            <field name="context">{'default_storage_contract': 1}</field>
            <field name="view_type">form</field>
             <field name="domain">[('storage_contract', '=', True)]</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p>
                    No Storage Contract.
                </p>
            </field>
        </record>

        <record model="ir.actions.act_window.view" id="action_stock_picking_driver_tree">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="sale.view_quotation_tree_with_onboarding"/>
            <field name="act_window_id" ref="action_storage_contract"/>
        </record>

        <record model="ir.actions.act_window.view" id="action_stock_picking_driver_form">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="price_paper.view_storage_contract_order_form"/>
            <field name="act_window_id" ref="action_storage_contract"/>
        </record>

        <menuitem id="menu_create_storage_contract"
                  name="Storage Contract"
                  action="action_storage_contract"
                  parent="sale.sale_order_menu"
                  sequence="4"/>
    </data>
</odoo>
